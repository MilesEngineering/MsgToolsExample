# MsgToolsExample
A set of message definitions that serves as both an example of how one could
implement their own program using [MsgTools](https://github.com/MilesEngineering/MsgTools) and a live demo of a [MsgTools](https://github.com/MilesEngineering/MsgTools) web application.

To learn more about MsgTools, [read the wiki](https://github.com/MilesEngineering/MsgTools/wiki).

## The MsgTools Embedded Example App
The MsgTools embedded example app is designed to run on a [SAMV71 eval board](https://www.microchip.com/Developmenttools/ProductDetails/DM320113), but also runs natively on a Linux development PC.

## The MsgTools Web App
The MsgToolsExample web app uses [jQuery](https://jquery.com/), [Golden Layout](http://golden-layout.com/), [webDav](https://en.wikipedia.org/wiki/WebDAV), and [MsgTools](https://github.com/MilesEngineering/MsgTools/) to build a simple dashboard for sending, receiving, and visualizing messages.

This example uses MsgTools' auto-generated JavaScript, located in
`/obj/CodeGenerator/JavaScript`, which is based on fake messages. The autogenerated code
is created in step 3 of 'Get up and running'.

WebDAV is an Http extension that is used to be able to save, delete, and store
GoldenLayout configurations on the server in the `html/configs` directory.

## Get started

1. Clone this repo: `git clone --recursive git@github.com:MilesEngineering/MsgToolsExample.git`
2. Install stuff
  * `sudo apt-get install python3-pyqt5.qtwebsockets python3-pyqtgraph` # GUI tools as Ubuntu packages
  * `sudo apt-get install gcc-multilib g++-multilib` # microcontroller build tools
  * `pip3 install wsgidav cheroot --user` # dependencies for the webserver
  * `pip3 install msgtools[gui] --user` # msgtools, with GUI option
3. `cd MsgToolsExample` and then run `make` to build everything

## Run some stuff to try it about

1. run `msglauncher &`, then click to start msgserver and msgscope (or just run `msgserver &` and `msgscope &` from terminal)
2. Web app
  * `cd html` and run `make` to run the webdav server
  *  Open a browser at [http://localhost:8000/html/demo.html](http://localhost:8000/html/demo.html)
3. `./embedded/example_app/obj/Linux/example_app` to run the Linux example application.

## Development

### Organization

#### `MsgToolsExample/`

Includes the makefile to run in order to create the `obj` directory based on
the message definitions defined in `MsgToolsExample/messages/` YAML. For more information
on this, [read the wiki](https://github.com/MilesEngineering/MsgTools/wiki/Why-MsgTools%3F).

#### `MsgToolsExample/embedded/`, `MsgToolsExample/messages/`, `MsgToolsExample/obj/`

These directories are all msgtools-specific, and only `MsgToolsExample/messages/`
and `MsgToolsExample/obj/` are required for the webapp to run. The `MsgToolsExample/embedded/`
directory is used to show how to implement embedded code using MsgTools.

#### `MsgToolsExample/html/`

Used to house the web app.

The base html file for this project is `demo.html` which pulls in all the
necessary dependencies. The meat of the app is in the `/hmtl/msgtools` directory,
which uses web components to produce the various gui elements with a connection
to the auto-generated javascript. The code that tells the msgtools web components
what messages to load is in `html/load.js`. The Golden Layout-specific code,
including the code to create the navs to drag-and-drop new panes into the dashboard,
is in `html/layout.js`.

### Styling

Styling this app is done in two ways: inline in the msgtools web components, and in
regular css in `html/css/msgtools-theme.css`. Because of the way web components
are encapsulated in the shadow dom, we use [bridges](https://meowni.ca/posts/styling-the-dome/)
of CSS custom properties to set specific styles for the components. To make
development easier, these custom properties have been listed at the bottom of the
`html/css/msgtools-theme.css` file.
